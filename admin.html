<!DOCTYPE html>
<html lang="om">
<head>
    <meta charset="UTF-8">
    <title>Admin - Aira Genaral Hospital</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-container { max-width: 700px; margin: 50px auto; padding: 20px; }
        .admin-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 25px; }
        input, textarea { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; }
        button { padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-post { width: 100%; background: #004aad; color: white; }
        .btn-post:hover { background: #003580; }
        .btn-delete { background: #ff4757; color: white; padding: 5px 10px; font-size: 12px; }
        .btn-logout { background: #636e72; color: white; margin-top: 20px; }
        h2 { font-size: 1.2rem; color: #333; border-bottom: 2px solid #004aad; padding-bottom: 5px; margin-bottom: 15px; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; background: #f9f9f9; margin-bottom: 5px; border-radius: 5px; }
        #auth-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 1000; display: flex; align-items: center; justify-content: center; visibility: visible; }
    </style>
</head>
<body>

    <div id="auth-overlay">
        <div class="admin-card" style="text-align: center;">
            <h2>Admin Login</h2>
            <p>Maaloo email fi password kee galchi.</p>
            <button onclick="loginAdmin()" style="background: #2ecc71; color: white; width: 200px;">Login Amma</button>
        </div>
    </div>

    <div class="admin-container">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>Aira General Hospital Admin</h1>
            <button onclick="logoutAdmin()" class="btn-logout">Log Out</button>
        </div>
        
        <div class="admin-card">
            <h2>1. Oduu Maxxansi</h2>
            <input type="text" id="newsTitle" placeholder="Mata duree oduu...">
            <textarea id="newsContent" placeholder="Ibsa oduu..."></textarea>
            <input type="file" id="newsFile" accept="image/*">
            <button class="btn-post" onclick="handleUpload('news')">Oduu Maxxansi</button>
            <div id="list-news" style="margin-top: 20px;"></div>
        </div>

        <div class="admin-card">
            <h2>2. Specialist Dabali</h2>
            <input type="text" id="specName" placeholder="Maqaa Dr...">
            <input type="text" id="specField" placeholder="Gosa Yaalaa (Cardiology, etc)...">
            <input type="file" id="specFile" accept="image/*">
            <button class="btn-post" onclick="handleUpload('specialists')">Specialist Galmeessi</button>
            <div id="list-specialists" style="margin-top: 20px;"></div>
        </div>

        <div class="admin-card">
            <h2>3. Tajaajila (Service) Dabali</h2>
            <input type="text" id="servTitle" placeholder="Maqaa Tajaajilaa...">
            <textarea id="servDesc" placeholder="Ibsa tajaajilaa..."></textarea>
            <input type="file" id="servFile" accept="image/*">
            <button class="btn-post" onclick="handleUpload('services')">Tajaajila Galmeessi</button>
            <div id="list-services" style="margin-top: 20px;"></div>
        </div>

        <p><a href="index.html">‚Üê Gara Websayititti Deebi'i</a></p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCzeW0zLkD6FNXpbxn7U9M5rilDQ8cEnJU",
            authDomain: "deebii-market.firebaseapp.com",
            projectId: "deebii-market",
            storageBucket: "deebii-market.firebasestorage.app",
            messagingSenderId: "582654848501",
            appId: "1:582654848501:web:3956d0a5a7c82e082ac4bc"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // --- LOGIN SYSTEM ---
        window.loginAdmin = async () => {
            const email = prompt("Email kee galchi:");
            const password = prompt("Password kee galchi:");
            try {
                await signInWithEmailAndPassword(auth, email, password);
                alert("Baga nagaan dhufte!");
            } catch (err) {
                alert("Icciitiin dogoggora!");
                window.location.href = "index.html";
            }
        };

        window.logoutAdmin = () => signOut(auth).then(() => location.reload());

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('auth-overlay').style.display = 'none';
                loadAdminLists();
            }
        });

        // --- UPLOAD LOGIC ---
        async function uploadToImgur(file) {
            const formData = new FormData();
            formData.append("image", file);
            const response = await fetch("https://api.imgur.com/3/image", {
                method: "POST",
                headers: { Authorization: "Client-ID 546c25a59c58ad7" }, 
                body: formData
            });
            const resData = await response.json();
            if(!resData.success) throw new Error("Suuraa fe'uun hin danda'amne!");
            return resData.data.link;
        }

        window.handleUpload = async (type) => {
            let data = {};
            let fileInput;
            try {
                if(type === 'news') {
                    fileInput = document.getElementById('newsFile');
                    data = { title: document.getElementById('newsTitle').value, content: document.getElementById('newsContent').value };
                } else if(type === 'specialists') {
                    fileInput = document.getElementById('specFile');
                    data = { name: document.getElementById('specName').value, field: document.getElementById('specField').value };
                } else if(type === 'services') {
                    fileInput = document.getElementById('servFile');
                    data = { title: document.getElementById('servTitle').value, desc: document.getElementById('servDesc').value };
                }

                const file = fileInput.files[0];
                if(!file) return alert("Maaloo suuraa filadhu!");

                const btn = event.target;
                btn.innerText = "Fe'amaa jira...";
                btn.disabled = true;

                const imageUrl = await uploadToImgur(file);
                data.imageUrl = imageUrl;
                data.timestamp = serverTimestamp();
                data.date = new Date().toLocaleDateString('en-GB');

                await addDoc(collection(db, type), data);
                alert("Milkaa'inaan galmeeffameera!");
                location.reload();
            } catch (err) {
                alert("Dogoggora: " + err.message);
                location.reload();
            }
        };

        // --- DELETE LOGIC ---
        async function loadAdminLists() {
            const sections = ['news', 'specialists', 'services'];
            for (const s of sections) {
                const q = query(collection(db, s), orderBy("timestamp", "desc"));
                const snap = await getDocs(q);
                const container = document.getElementById(`list-${s}`);
                container.innerHTML = `<p style="font-weight:bold; font-size:14px;">Maxxansoota ${s} jiran:</p>`;
                snap.forEach(docSnap => {
                    const d = docSnap.data();
                    container.innerHTML += `
                        <div class="list-item">
                            <span>${d.title || d.name}</span>
                            <button class="btn-delete" onclick="deleteItem('${s}', '${docSnap.id}')">Haqi</button>
                        </div>`;
                });
            }
        }

        window.deleteItem = async (col, id) => {
            if (confirm("Dhuguma haquu barbaaddu?")) {
                await deleteDoc(doc(db, col, id));
                alert("Haqameera!");
                location.reload();
            }
        };
    </script>
</body>

</html>
